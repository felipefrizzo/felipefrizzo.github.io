<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Felipe Frizzo</title>
        <meta name="author">
        <meta name="description" content="The awesome blog of Felipe Frizzo.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.27" />
        <link href="http://felipefrizzo.github.io/post/index.xml" rel="alternate" type="application/rss+xml" title="Felipe Frizzo" />
        <link href="http://felipefrizzo.github.io/post/index.xml" rel="feed" type="application/rss+xml" title="Felipe Frizzo" />
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700|Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://felipefrizzo.github.io/css/styles.css">
        <link rel="icon" href="http://felipefrizzo.github.io/favicon.ico">
        <link rel="apple-touch-icon" href="http://felipefrizzo.github.io/apple-touch-icon.png" />
        <link rel="stylesheet" href="http://felipefrizzo.github.io/css/highlightjs/monokai.css">
        <script src="http://felipefrizzo.github.io/js/vendor/modernizr-2.8.0.min.js"></script>
        
        <style>
        .site-header h2 .logo {
        background: url(http://felipefrizzo.github.io/img/desk.jpg) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(http://felipefrizzo.github.io/img/desk.jpg);
        }}
       .site-header {
         background: #2a373d url(http://felipefrizzo.github.io/img/desk.jpg) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        <header class="site-header">
          <div class="transparent-layer">
              <h2>Felipe Frizzo</h2>
          </div>
        </header>


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="http://felipefrizzo.github.io" title="">&laquo; </a>
            
<h1><a href="http://felipefrizzo.github.io/post/wercker/" title="Wercker - Build e Deploy de maneira facil no Heroku de uma aplicação Python">Wercker - Build e Deploy de maneira facil no Heroku de uma aplicação Python</a></h1>

<footer class="post-info"> <span class="post-meta"><time datetime="2016.02.03">2016.02.03</time>

    &middot; 
        
        <a href="http://felipefrizzo.github.iotags/devops">devops</a>, 
        
        <a href="http://felipefrizzo.github.iotags/deploy">deploy</a>, 
        
        <a href="http://felipefrizzo.github.iotags/heroku">heroku</a>, 
        
        <a href="http://felipefrizzo.github.iotags/python">python</a>, 
        
        <a href="http://felipefrizzo.github.iotags/django">django</a>, 
        
        <a href="http://felipefrizzo.github.iotags/development">development</a>
        
    

</span>
</footer>

            <p>O que é o <a href="http://wercker.com">Wercker</a>?</p>

<p>Wercker é uma plataforma para facilitar as tarefas de build e deployment. A versão atual utiliza <a href="http://docker.com">Docker</a> para executar seus builds, assim você pode usar o Wercker para fazer o build e deployment de qualquer linguagem basta utilizar uma imagem Docker e configurar os passos a serem executados pelo. Você pode customizar scripts para executar os passos tanto no build quanto no deployment assim evitando retrabalho quando precisar fazer o processo para outra aplicação que tenha a mesma estrutura.</p>

<p>Agora vamos a um exemplo, que vou utilizar as configurações que fiz para o build e deployment do projeto <a href="http://eventex-felipefrizzo.herokuapp.com/">Eventex</a> do curso <a href="http://welcometothedjango.com.br/">Welcome to the Django</a>, que está no Heroku.</p>

<pre><code>box: python:3.5
services:
    - postgres

build:
  steps:
    - pip-install:
        requeriments_file: &quot;requeriments.txt&quot;
    - script:
        name: Run Test
        code: |
            python manage.py test

deploy:
    steps:
        - heroku-deploy:
            instalar-toolbelt: true
            key: $HEROKU_KEY
            user: $HEROKU_USER
            app-name: $HEROKU_APP_NAME

</code></pre>

<p>Como o Wekcker utiliza Docker podemos utilizar qualquer imagem Docker, neste caso estou utilizando <strong>python:3.5</strong>.</p>

<p><strong>services</strong> Serviços são boxes prontos disponibilizados pelo Wercker, como PostgreSql, MongoDB, etc. Em outras palavras, é um container configurado com um serviço ready to use.</p>

<p>Os passos para executar o build e criar os arquivos para deployment estão descritos em <strong>build</strong>.</p>

<p>Os Passos:</p>

<ul>
<li><strong>pip-install</strong> instala todos os requeriments nessecessarios para rodar a aplicação <strong>Python</strong>.</li>
<li><strong>script</strong> a etapa de script permite que você pode executar um comando Shell.</li>
<li><strong>Run Test</strong> roda os testes da aplicação, caso de erro nos testes não passa para o depoy.</li>
</ul>

<p>O deployment</p>

<ul>
<li><strong>heroku-deploy</strong> Aqui preciso configurar <strong>toolbelt</strong>, o <strong>HEROKU_KEY</strong>, o <strong>HEROKU_USER</strong>, o <strong>HEROKU_APP_NAME</strong>.

<ul>
<li><strong>instalar-toolbelt</strong> instala o toolbelt para poder utilizar o heroku.</li>
<li><strong>HEROKU_KEY</strong> e <strong>HEROKU_USER</strong> e <strong>HEROKU_APP_NAME</strong> é uma variavel de ambiente que configuramos no settings do projeto. Mas esta mais especifamente esta configurada para estar disponível somento no momento em que os passos de deployment estão sendo executados.</li>
</ul></li>
</ul>

<p>Agora que temos o nosso projeto configurado com um arquivo <strong>wercker.yml</strong> vamos fazer as configurações no ambiente do Wercker.
Vamos criar uma nova aplicação
<img src="http://felipefrizzo.github.io/imgs/post/wercker/wercker.png" alt="alt text" /></p>

<p>No primeiro passo vamos selecionar se o nosso repositório esta no GitHub ou no BitBucket.
<img src="http://felipefrizzo.github.io/imgs/post/wercker/Wercker-1.png" alt="alt text" /></p>

<p>O segundo passo qual o repositório que vamos utilizar.
<img src="http://felipefrizzo.github.io/imgs/post/wercker/Wercker-2.png" alt="alt text" /></p>

<p>Quarto passo selecionamos a forma como o wercker vai baixar o repositório.
<img src="http://felipefrizzo.github.io/imgs/post/wercker/Wercker-3.png" alt="alt text" /></p>

<p>No quinto passo o wercker vai tentar identificar qual linguagem esta sendo utilizada no repositório e vai criar um arquivo <strong>wercker.yml</strong> inicial.
<img src="http://felipefrizzo.github.io/imgs/post/wercker/Wercker-4.png" alt="alt text" /></p>

<p>O sexto e ultimo passo é para confirmar a criação da aplicação e decidir se você quer tornar esse repositório publico.
<img src="http://felipefrizzo.github.io/imgs/post/wercker/Wercker-5.png" alt="alt text" /></p>

<p>No passo a seguir vamos configurar onde faremos o deployment.
<img src="http://felipefrizzo.github.io/imgs/post/wercker/Wercker-deploy.png" alt="alt text" /></p>

<p>Vamos adicionar um novo deploy target do tipo <strong>Custom Deploy</strong>.
* Em <strong>Deploy Target Name</strong> vamos colocar Heroku.
* Vamos selecionar o <strong>Auto Deploy</strong> assim toda vez que um novo commit for feito além do build também será executado os passos para deploy se o build ocorrer com sucesso. E também devemos indicar qual o branch será usado.</p>

<p>Vamos precisar adicionar algumas variáveis para ser utilizado pelo deploy. Faremos isso com <strong>HEROKU_KEY</strong> e <strong>HEROKU_USER</strong> e <strong>HEROKU_APP_NAME</strong>, todas marcadas como <em>Protected</em>.
<img src="http://felipefrizzo.github.io/imgs/post/wercker/Wercker-deploy-1.png" alt="alt text" /></p>

<p>E caso sua aplicação tenha variaveis de ambiente com está, basta adiciona-las na aba <strong>Variaveis De Ambiente</strong></p>

<p><img src="http://felipefrizzo.github.io/imgs/post/wercker/Wercker-Environment-variable.png" alt="alt text" /></p>

<p>E agora podemos alterar nosso código fazer pull para o repositório e deixar o Wercker fazer o resto do trabalho.</p>

<p>O Wercker também possui on cliente(OsX e Linux) que permitir baixarmos um container gerado por um build do wercker para rodar localmente com Docker. Isto é util quando precisamos descobrir porque nosso build não esta funcionando como deveria.</p>

<p>Para instalar o wercker no OsX.</p>

<pre><code>curl https://s3.amazonaws.com/downloads.wercker.com/cli/stable/linux_amd64/wercker -o /usr/local/bin/wercker
</code></pre>

<p>No Linux</p>

<pre><code>curl https://s3.amazonaws.com/downloads.wercker.com/cli/stable/linux_amd64/wercker -o /usr/local/bin/wercker
</code></pre>

<p>E por fim precisamos executar a seguinte linha tanto para OsX quanto para Linux.</p>

<pre><code>chmod +x /usr/local/bin/wercker
</code></pre>

<p>Documentação <a href="http://devcenter.wercker.com/docs/index.html">http://devcenter.wercker.com/docs/index.html</a>
Documentação da API <a href="http://devcenter.wercker.com/api/index.html">http://devcenter.wercker.com/api/index.html</a></p>

            <ul class="share-buttons">
    <li></li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2ffelipefrizzo.github.io%2fpost%2fwercker%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=Wercker%20-%20Build%20e%20Deploy%20de%20maneira%20facil%20no%20Heroku%20de%20uma%20aplica%c3%a7%c3%a3o%20Python&amp;url=http%3a%2f%2ffelipefrizzo.github.io%2fpost%2fwercker%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2ffelipefrizzo.github.io%2fpost%2fwercker%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2ffelipefrizzo.github.io%2fpost%2fwercker%2f&title=Wercker%20-%20Build%20e%20Deploy%20de%20maneira%20facil%20no%20Heroku%20de%20uma%20aplica%c3%a7%c3%a3o%20Python" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title=""></a>
    </li>
</ul>

        </article>
        
    </main>
    <aside class="author">
  <img class="profile-image" src="http://felipefrizzo.github.io/img/profile-image.png" alt="Felipe Frizzo" />
  <p class="name"> 
  <strong>Felipe Frizzo</strong></p>
  <p class="address">Cascavel, Paraná</p>
  <p class="link"></p>
  <ul class="social">
    
<li><a href="//twitter.com/felipefrizzo" class="icon-twitter" target="_blank" title="Twitter"></a></li>



<li><a href="//facebook.com/felipefrizzo" class="icon-facebook-squared" target="_blank" title="Facebook"></a></li>



<li><a href="//linkedin.com/in/felipefrizzo" class="icon-linkedin" target="_blank" title="Linkedin"></a></li>







<li><a href="//instagram.com/felipefrizzo" class="icon-instagram" target="_blank" title="Instagram"></a></li>



<li><a href="//github.com/felipefrizzo" class="icon-github" target="_blank" title="Github"></a></li>



<li><a href="//plus.google.com/+felipefrizzo" class="icon-gplus" target="_blank" title="Google+"></a></li>


<li><a href="http://felipefrizzo.github.iopost/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="http://felipefrizzo.github.io/post/index.xml" title="RSS"></a>
        <p>&copy; 2017 &middot; Copyright 2016, Felipe Frizzo; all rights reserved.</p>
  </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="http:\/\/felipefrizzo.github.io\/js\/vendor\/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://felipefrizzo.github.io/js/plugins.js"></script>




</body>
</html>

